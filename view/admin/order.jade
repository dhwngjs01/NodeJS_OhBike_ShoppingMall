doctype html
html
	head
		include adminHead.jade
	body#page-top
		include adminHeader.jade
		#wrapper
			include adminSideBar.jade
			
			#content-wrapper
				.container-fluid
					// Breadcrumbs
					ol.breadcrumb
						li.breadcrumb-item
							a(href='/admin/dashboard') 관리자 페이지
						li.breadcrumb-item.active 주문관리

					// DataTables Example
					.card.mb-3
						.card-header
							i.fas.fa-fw.fa-box
							|  주문목록
						.card-body
							.table-responsive
								table.table.table-sm.table-bordered(width='100%', cellspacing='0')
									thead
										tr
											th 주문번호
											th 제품명
											th 사이즈
											th 수량
											th 가격
											th 주문자
											th 배송상태
											th 주문일자
									tfoot
										tr
											th 주문번호
											th 제품명
											th 사이즈
											th 수량
											th 가격
											th 주문자
											th 배송상태
											th 주문일자
									tbody
										each order in orderList
											tr
												td.text-center.align-middle #{order.detail_no}
												td.align-middle #{order.product_name}
												td.text-center.align-middle #{order.option_name}
												td.text-right.align-middle #{order.option_num}
												td.text-right.align-middle #{order.product_price.numberWithCommas()}
												td.text-center.align-middle #{order.user_name}
												td
													select#select-order-status.form-control(name="order_status" data-detail-no="#{order.detail_no}" data-order-status="#{order.order_status}")
														each status in orderStatusList
															if status == order.order_status
																option(value="#{status}" selected) #{status}
															else
																option(value="#{status}") #{status}
												td.text-right.align-middle #{order.order_date.format("yyyy년 MM월 dd일 HH시 mm분 ss초")}
					
				include adminFooter.jade
			// /.content-wrapper
			// /#wrapper
			// Scroll to Top Button
			a.scroll-to-top.rounded(href='#page-top')
				i.fas.fa-angle-up
			
		include adminScript.jade
		script.
			$(document).ready(function(){
				$('.table').DataTable();

				$("#select-order-status").change(function(){
					self = $(this);
					orderStatus = $(this).val();
					detail_no = $(this).data("detail-no");

					$.ajax({
						type : "POST",
						url : "/admin/order/change",
						data : { order_status : orderStatus, detail_no : detail_no },
						success : function(res){
							console.log(res);
							$(self).parent().parent().find(".order-status").text(orderStatus);
						},
						error : function(e){
							console.log(e);
						}
					});
				});
			});

			$("select").each(function(key, el){
				self = $(this);
				order_status = $(el).data("order-status");

				$("select option").each(function(key, option){
					if(order_status == $(option).val()){
						$(self).find("option").eq(key).prop("selected", true);
					}
				});
			});

			function productChangeStatus(self, product_no){
				$.ajax({
					type : "POST",
					url : "/admin/product/delete",
					data : { product_no : product_no },
					success : function(res){
						if(res.changeProductStatus){
							if($(self).text() == "활성화"){
								$(self).text("비활성화");
								$(self).removeClass("btn-success").addClass("btn-danger");
							} else {
								$(self).text("활성화");
								$(self).removeClass("btn-danger").addClass("btn-success");
							}
						}
					},
					error : function(e){
						console.log(e);
					}
				})
			}